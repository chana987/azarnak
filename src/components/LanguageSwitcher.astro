---
import { getTranslations, getLocaleFromRequest, getAvailableLocales, type Locale } from '../i18n';

const currentLocale = getLocaleFromRequest(Astro.request);
const availableLocales = getAvailableLocales();

const localeNames: Record<Locale, string> = {
  en: 'En',
  he: 'עב'
};
---

<div class="language-switcher">
  {availableLocales.map((locale) => (
    <a
      href={`?locale=${locale}`}
      class:list={['locale-btn', { active: locale === currentLocale }]}
      data-locale={locale}
    >
      {localeNames[locale]}
    </a>
  ))}
</div>

<script>
  // Client-side language switching
  document.addEventListener('DOMContentLoaded', () => {
    const languageSwitcher = document.querySelector('.language-switcher');
    if (!languageSwitcher) return;

    languageSwitcher.addEventListener('click', (e) => {
      const target = e.target as HTMLElement;
      if (target.classList.contains('locale-btn')) {
        e.preventDefault();
        const locale = target.getAttribute('data-locale');
        if (locale) {
          // Set cookie
          document.cookie = `locale=${locale}; path=/; max-age=${60 * 60 * 24 * 365}`; // 1 year
          // Reload page
          window.location.reload();
        }
      }
    });
  });
</script>
